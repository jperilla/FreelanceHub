@model Web.Models.Account

<div class="right-small-margin"><small> @Html.Raw("Not happy with your search results?")</small> @Html.ActionLink("Customize Your Search", "UserView", "CustomSearch", null, null)</div>

<h2>What type of work are you looking for, @Model.CustomerFirstName?</h2>


<!--
<div>
    <form id="cref_iframe" action="@Url.Action("GoogleSearchResults", "Search")" >
      <div class="editor-field left xlong">
        <input type="hidden" name="cref" value="@Model.PathToGoogleCseFile" />
        <input type="hidden" name="cof" value="FORID:9" />
        <input type="text"  class="whole tall left" name="q" size="40" /> 
        <div class="right-small-margin"><small> @Html.Raw("Not happy with your search results?")</small> @Html.ActionLink("Customize Your Search", "UserView", "CustomSearch", null, null)</div>  
      </div>
      <input type="submit" name="sa" value="Search" class="right red small" />
   </form>
    <script type="text/javascript" src="'/cse'/brand'?form='cref_iframe" ></script>
    
</div>


<div id="cse-search-results"></div>
<script type="text/javascript">
    var googleSearchIframeName = "cse-search-results";
    var googleSearchFormName = "cse-search-box";
    var googleSearchDomain = "www.google.com";
    var googleSearchPath = "/cse";
</script>
<script type="text/javascript" src="http://www.google.com/afsonline/show_afs_search.js"></script>-->
<input type="hidden" id="custom-sites" name="sites" value="@Model.SitesToSearchString" />
<div id="cse" style="width:100%;"></div>
<div style="display:none">

    <div id="fria_webResult">
        
        <div class="gs-webResult gs-result"
             data-vars="{longUrl:function() {
        var i = unescapedUrl.indexOf(visibleUrl);
        return i < 1 ? visibleUrl : unescapedUrl.substring(i);}}">
            <div data-if="Vars.richSnippet" data-attr="0"
                 data-body="render('thumbnail',richSnippet,{url:unescapedUrl,target:target})"></div>
            <div class="gs-title">
                <a class="gs-title" data-attr="{href:unescapedUrl,target:target}"
                   data-body="html(title)"></a>
            </div>
            <div class="gs-snippet" data-body="html(content)"></div>

            <div class="gs-visibleUrl gs-visibleUrl-short" data-body="visibleUrl"></div>
            <div class="gs-visibleUrl gs-visibleUrl-long" data-body="longUrl()"></div>
            <div data-if="Vars.richSnippet && Vars.richSnippet.action" class="gs-actions"
                 data-body="render('action',richSnippet,{url:unescapedUrl,target:target})"></div>
            <a class="red small right" data-attr="{href:'@Url.Action("RedirectDisclaimerUrl", "Search")?url=' + unescapedUrl,target:target}" style="background:url(/Content/images/apply.png) no-repeat left center;"></a>
        </div>
    </div>

  <div id="fria_thumbnail">
    <div data-attr="0" data-vars="{tn:Vars.thumbnail && thumbnail.src
        ? thumbnail : {src:Vars.document && document.thumbnailUrl}}">
      <div data-if="tn.src" class="gs-image-box gs-web-image-box">
        <a class="gs-image" data-attr="{href:url,target:target}">
          <img class="gs-image" src=""
            data-attr="{src:tn.src, width:tn.width || 100, height: tn.height}"/>
        </a>
      </div>
    </div>
  </div>

  <div id="fria_action">
    <div data-foreach="Vars.action" data-attr="0">
      <div data-attr="{'class': 'gs-action ' + Cur['class']}"
          data-if="Cur.url && Cur.label">
        <a class="gs-action" data-attr="{href:Cur.url,target:target}"
          data-body="Cur.label"></a>
      </div>
    </div>
  </div>
</div>

<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">

    google.load('search', '1', { language: 'en', style: google.loader.themes.MINIMALIST });
    google.setOnLoadCallback(function () {
        var customSearchOptions = {};
        var orderByOptions = {};
        var siteString = $("#custom-sites").val();
        orderByOptions['keys'] = [{ label: 'Date', key: 'date' }, { label: 'Relevance', key: ''}];
        customSearchOptions['enableOrderBy'] = true;
        customSearchOptions['orderByOptions'] = orderByOptions;
        customSearchOptions['adoptions'] = { 'layout': 'noTop' };
        //customSearchOptions[google.search.Search.RESTRICT_EXTENDED_ARGS] = { 'as_sitesearch': 'jobs.problogger.net/view/' };

        //customSearchOptions['crefUrl'] = $('#user-search').val();
        var customSearchControl = new google.search.CustomSearchControl('013914245334065375847:dl-lwlywdoi', customSearchOptions);
        google.search.Csedr.addOverride("fria_");
        customSearchControl.setRefinementStyle(google.search.SearchControl.REFINEMENT_AS_LINK);
        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        customSearchControl.setOnKeepCallback(this, onFavorite, google.search.SearchControl.KEEP_LABEL_BLANK);
        customSearchControl.setSearchStartingCallback(this, function (control, searcher, query) {
            searcher.setQueryAddition(siteString);
        });
        customSearchControl.draw('cse');
    }, true);

    var onFavorite = function (result) {
        if (result) {
            var newJob = {
                ShortDescription: stripHtml(result.content),
                Title: stripHtml(result.title),
                URL: stripHtml(result.url),
                Budget: "$100"
            };

            $.post('@Url.Action("SaveFavorite", "Jobs")', newJob, function (data) {
                // TODO: find the result url in the dom and then go parent, parent, find keeper
                keeper.css("background", "url(/Content/images/star-gold32.png) no-repeat right top;");
            }).error(function (data) {

            });

        }
    };

    function stripHtml(str) {
        return jQuery('<div />', { html: str }).text();
    } 
</script>